<div class="container calendar-page p-0 px-sm-1 py-sm-1">
  <app-page-header [title]="moduleStrings.headerTitle">
    <div
      *ngIf="isAdmin$ | async"
      header-action
      class="d-none d-sm-flex align-items-center gap-2 ms-auto"
    >
      <button
        *ngIf="isAdmin$ | async"
        header-action
        type="button"
        class="btn text-white btn-sm d-inline-flex align-items-center"
        (click)="onGenerateMatches()"
        aria-label="Wygeneruj terminarz"
      >
        <i class="fa-solid fa-wand-magic-sparkles" aria-hidden="true"></i>
        <span class="ms-2">{{ moduleStrings.generateMatches }}</span>
      </button>

      <button
        *ngIf="isAdmin$ | async"
        header-action
        type="button"
        class="btn text-white btn-sm d-inline-flex align-items-center"
        (click)="onAddMatch()"
        aria-label="Dodaj mecz"
      >
        <i class="fa-solid fa-plus" aria-hidden="true"></i>
        <span class="ms-2">{{ moduleStrings.addMatch }}</span>
      </button>

      <button
        *ngIf="isAdmin$ | async"
        header-action
        type="button"
        class="btn btn-sm text-white d-inline-flex align-items-center"
        (click)="onDeleteAllMatches()"
        aria-label="Usuń wszystkie mecze"
      >
        <i class="fa-solid fa-trash-can" aria-hidden="true"></i>
        <span class="ms-2">{{ moduleStrings.deleteAllMatches }}</span>
      </button>
    </div>
    <div
      *ngIf="isAdmin$ | async"
      header-action
      class="d-flex d-sm-none ms-auto"
    >
      <div class="dropdown">
        <button
          class="btn btn-sm text-white"
          type="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
          aria-label="Więcej akcji"
        >
          <i class="fa-solid fa-ellipsis-vertical"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li>
            <button
              class="dropdown-item d-flex align-items-center"
              (click)="onGenerateMatches()"
            >
              <i class="fa-solid fa-wand-magic-sparkles me-2"></i>
              {{ moduleStrings.generateMatches }}
            </button>
          </li>
          <li>
            <button
              class="dropdown-item d-flex align-items-center"
              (click)="onAddMatch()"
            >
              <i class="fa-solid fa-plus me-2"></i>
              {{ moduleStrings.addMatch }}
            </button>
          </li>
          <li><hr class="dropdown-divider" /></li>
          <li>
            <button
              class="dropdown-item text-danger d-flex align-items-center"
              (click)="onDeleteAllMatches()"
            >
              <i class="fa-solid fa-trash-can me-2"></i>
              {{ moduleStrings.deleteAllMatches }}
            </button>
          </li>
        </ul>
      </div>
    </div>
  </app-page-header>

  <div class="calendar-list">
    <div
      class="accordion d-flex flex-column gap-1 gap-md-2"
      id="calendarAccordion"
    >
      <ng-container *ngIf="days$ | async as days; else loading">
        <app-calendar-day
          *ngFor="let day of days; trackBy: trackByDate"
          [date]="day.date"
          [matches]="day.matches"
          (matchClicked)="openDetails($event)"
          (editMatch)="onEditMatch($event)"
          (deleteMatch)="onDeleteMatch($event)"
        >
        </app-calendar-day>
      </ng-container>
      <ng-template #loading>
        <app-spinner></app-spinner>
      </ng-template>
    </div>
  </div>
</div>

<app-match-details-modal
  [match]="selectedMatch"
  [teamMap]="teamMap$ | async"
  [playerMap]="playerMap$ | async"
  (close)="closeDetails()"
  (requestVoteConfirm)="onRequestVoteConfirm($event)"
></app-match-details-modal>

<app-confirm-modal
  #confirmModal
  [title]="confirmStrings.title"
  [message]="confirmStrings.message"
  [labels]="confirmStrings.labels"
  [size]="'md'"
  [confirmVariant]="'primary'"
></app-confirm-modal>

<app-dynamic-form
  #addMatchFormRef
  [formTitle]="formTitleAddMatch"
  [fields]="addMatchFormFields"
  [isOpen]="openAddMatchFormModal"
  (formSubmitted)="onAddMatchFormSubmitted($event)"
  (valueChanges)="onAddMatchFormChanged($event)"
  (close)="openAddMatchFormModal = false"
></app-dynamic-form>

<app-dynamic-form
  #editMatchFormRef
  [formTitle]="formTitleEditMatch"
  [fields]="editMatchFormFields"
  [isOpen]="openEditMatchFormModal"
  (formSubmitted)="onEditMatchFormSubmitted($event)"
  (valueChanges)="onEditMatchFormChanged($event)"
  (close)="openEditMatchFormModal = false"
>
</app-dynamic-form>

<app-dynamic-form
  [formTitle]="formTitleGenerate"
  [fields]="generateFormFields"
  [isOpen]="openGenerateFormModal"
  (formSubmitted)="onGenerateFormSubmitted($event)"
  (valueChanges)="onGenerateFormChanged($event)"
  (close)="openGenerateFormModal = false"
></app-dynamic-form>

<app-confirm-modal #deleteMatchConfirm></app-confirm-modal>

<app-confirm-modal #deleteAllMatchesConfirm></app-confirm-modal>

<app-spinner *ngIf="isLoading"></app-spinner>
